{% load static %}
<!DOCTYPE html>
<html lang="">
<head>
<title>SPark</title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<link href="{% static "layout/styles/layout.css"%}" rel="stylesheet" type="text/css" media="all">
</head>
 <!--JAVASCRIPTS -->
<script src="{% static "layout/scripts/jquery.min.js"%}"></script>
<script src="{% static "layout/scripts/jquery.backtotop.js"%}"></script>
<script src="{% static "layout/scripts/jquery.mobilemenu.js"%}"></script>
<script>
var lat ;
var lon ;
var x = document.getElementById("greeting");
var map;
var plate;

function getLocation() {
    if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(showPosition, showError);
    } else { 
        x.innerHTML = "Geolocation is not supported by this browser.";
    }
}

function showPosition(position) {
    lat = position.coords.latitude;
    lon = position.coords.longitude;
    var latlon = new google.maps.LatLng(lat, lon)
	console.log(lat+','+lon);

    var myOptions = {
    center:latlon,zoom:14,
    mapTypeId:google.maps.MapTypeId.ROADMAP,
    mapTypeControl:false,
    navigationControlOptions:{style:google.maps.NavigationControlStyle.SMALL}
    }
    
    map = new google.maps.Map(document.getElementById("googleMap"), myOptions);
    var marker = new google.maps.Marker({position:latlon,map:map,title:"You are here!"});
}

function showError(error) {
    switch(error.code) {
        case error.PERMISSION_DENIED:
            x.innerHTML = "User denied the request for Geolocation."
            break;
        case error.POSITION_UNAVAILABLE:
            x.innerHTML = "Location information is unavailable."
            break;
        case error.TIMEOUT:
            x.innerHTML = "The request to get user location timed out."
            break;
        case error.UNKNOWN_ERROR:
            x.innerHTML = "An unknown error occurred."
            break;
    }
}

function Reservation(){
	href="../availability/retrieve/";
	plate = document.getElementById("frm")["plateno"].value;
	var position = lat + ',' + lon;
	var price;
	var loc; 
	$.ajax({
            url: href,
            type: 'GET',
            dataType: 'json',
            data:{position:position,plate:plate},
            success: function(result){
            console.log(result['price']);
            console.log(result['position']);
			console.log(result['spotID']);
			loc = result['position'].split(' ').join('');
			
			loc = loc.split(',');
			$("#spotinfo").show();
			$("#spotinfo").html("ID:"+result['spotID'] +
			"<br> price="+result['price']+
			"<br>position="+result['position']);
			spotID = result['spotID'];
    var lo = new google.maps.LatLng(loc[0], loc[1]);
	map.setCenter(lo);
	var marker2 = new google.maps.Marker({
		position:lo,
		map:map,
		title:"$"+result["price"].toString()
	});
	
	 document.getElementById("frm")["plateno"].value;
	
	}});
	
}
	
function  ConfirmReservation(){
 href="../availability/confirm/"
	

    $.ajax({
            url: href,
            type: 'GET',
            dataType: 'json',
            data:{spotID:spotID,
            plate:plate
            },
            success: function(result){
            console.log(result['result']);
        }});
    




}




window.onload =getLocation;
</script>




<div class="wrapper bgded overlay" style="background-image:url("{% static "images/demo/backgrounds/01.png"%}");">
  <div id="pageintro" class="hoc clear"> 
    <article>
      <p id="greeting">Reserved your parking lot right now.</p>
	<form id="frm" action="">
  <input type="text"  name="plateno" placeholder= "Plate No">
  <input class="btn" name=""type="button" onclick="Reservation()" value="Request">
  <div id ="spotinfo" display="none"><input class="btn" name=""type="button" onclick="ConfirmReservation()" value="Confirm"></div>
</form>
    </article>

  </div>
</div>

<div id="googleMap" style="width:100%;height:400px;"></div>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDg1ZIu7sQZsrWM-mnHUeCKyQSuZuVeeDM"></script>
<div class="wrapper row5">
  <div id="copyright" class="hoc clear"> 

    <p class="fl_left">Copyright &copy; 2018 - All Rights Reserved - <a href="#">Domain Name</a></p>
    <p class="fl_right">Template by <a target="_blank" href="http://www.os-templates.com/" title="Free Website Templates">OS Templates</a></p>

  </div>
</div>

<a id="backtotop" href="#top"><i class="fas fa-chevron-up"></i></a>

</body>
</html>